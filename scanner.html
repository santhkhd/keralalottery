<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Scanner - Kerala Lottery</title>
    <link href="output.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --scanner-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --winner-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --not-found-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --card-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --hover-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        /* Enhanced modern styling */
        .enhanced-card {
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
        }
        
        .enhanced-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        .winner-card {
            background: var(--winner-gradient);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .scanner-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .scanner-input {
            background: white;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .scanner-result {
            min-height: 200px;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: white;
            box-shadow: var(--card-shadow);
        }
        
        .result-card {
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 25px;
            padding: 10px 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .lang-btn.active {
            background: var(--primary-gradient);
            color: white;
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            border-radius: 25px;
            padding: 10px 20px;
            box-shadow: var(--card-shadow);
            text-decoration: none;
            color: #333;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        @media (max-width: 768px) {
            .scanner-container {
                padding: 10px;
            }
            
            .language-selector {
                position: static;
                margin-bottom: 20px;
                justify-content: center;
            }
            
            .back-button {
                position: static;
                display: inline-block;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-purple-100">
    <!-- Back Button -->
    <a href="index.html" class="back-button" id="backButton">‚Üê Back to Home</a>
    
    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" onclick="switchLanguage('en')">EN</button>
        <button class="lang-btn" onclick="switchLanguage('ml')">ML</button>
        <button class="lang-btn" onclick="switchLanguage('ta')">TA</button>
    </div>

    <div class="scanner-container">
        <h1 class="text-4xl font-bold text-center mb-8 text-gray-800" id="pageTitle">Lottery Scanner</h1>
        
        <!-- Scanner Input Section -->
        <div class="scanner-input">
            <h2 class="text-2xl font-bold mb-6 text-gray-700" id="inputTitle">Scan Your Ticket</h2>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-lg font-medium mb-2 text-gray-700" id="numberLabel">Ticket Number</label>
                    <input type="text" id="ticketNumber" placeholder="Enter ticket number (e.g., PM 162584)" 
                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none transition-colors">
                </div>
                
                <div>
                    <label class="block text-lg font-medium mb-2 text-gray-700" id="dateLabel">Draw Date</label>
                    <input type="date" id="drawDate" 
                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none transition-colors">
                </div>
                
                <button onclick="processManualInput()" 
                        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 px-6 rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all transform hover:scale-105 shadow-lg">
                    <span id="scanButton">Scan Ticket</span>
                </button>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="scanner-result" id="scannerResults">
            <div class="text-gray-500" id="initialMessage">Enter your ticket details to check for winnings</div>
        </div>
    </div>

    <script>
        // UI Strings for different languages
        const langStrings = {
            en: {
                pageTitle: "Lottery Scanner",
                inputTitle: "Scan Your Ticket",
                numberLabel: "Ticket Number",
                dateLabel: "Draw Date",
                scanButton: "Scan Ticket",
                initialMessage: "Enter your ticket details to check for winnings",
                pleaseFill: "Please fill in all fields",
                winner: (count) => `üéâ YOU ARE A WINNER! Found ${count} winning entr${count === 1 ? 'y' : 'ies'}`,
                noWin: "üòî No Winning Numbers Found",
                betterLuck: "Better luck next time!",
                sorry: (number, date) => `Sorry, your number "${number}" was not found in any winning results for ${date}.`,
                keepTrying: "Keep trying with other numbers or check back for new results!",
                prizeAmount: "Prize Amount:",
                number: "Number:",
                date: "Date:",
                viewFullResult: "View Full Result Page",
                backToHome: "Back to Home",
                congratulations: "Congratulations on your win!"
            },
            ml: {
                pageTitle: "‡¥≤‡µã‡¥ü‡µç‡¥ü‡¥±‡¥ø ‡¥∏‡µç‡¥ï‡¥æ‡¥®‡µº",
                inputTitle: "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï",
                numberLabel: "‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥®‡¥Æ‡µç‡¥™‡µº",
                dateLabel: "‡¥°‡µç‡¥∞‡µã ‡¥§‡µÄ‡¥Ø‡¥§‡¥ø",
                scanButton: "‡¥∏‡µç‡¥ï‡¥æ‡µª ‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç",
                initialMessage: "‡¥µ‡¥ø‡¥ú‡¥Ø‡¥Ç ‡¥®‡µá‡¥ü‡¥ø‡¥Ø‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥£‡µç‡¥ü‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï",
                pleaseFill: "‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥´‡µÄ‡µΩ‡¥°‡µÅ‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥™‡µÇ‡¥∞‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï",
                winner: (count) => `üéâ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥í‡¥∞‡µÅ ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥Ø‡¥æ‡¥£‡µç! ${count} ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥ö‡µç‡¥ö ‡¥é‡µª‡¥ü‡µç‡¥∞‡¥ø‡¥ï‡µæ ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø`,
                noWin: "üòî ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥ö‡µç‡¥ö ‡¥®‡¥Æ‡µç‡¥™‡¥±‡µÅ‡¥ï‡µæ ‡¥í‡¥®‡µç‡¥®‡µÅ‡¥Ç ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤",
                betterLuck: "‡¥Ö‡¥ü‡µÅ‡¥§‡µç‡¥§ ‡¥§‡¥µ‡¥£ ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ ‡¥≠‡¥æ‡¥ó‡µç‡¥Ø‡¥Ç ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥ï‡¥ü‡µç‡¥ü‡µÜ!",
                sorry: (number, date) => `"${number}" ‡¥é‡¥®‡µç‡¥® ‡¥®‡¥Æ‡µç‡¥™‡µº ${date}-‡¥®‡µç ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥ö‡µç‡¥ö ‡¥´‡¥≤‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤.`,
                keepTrying: "‡¥Æ‡¥±‡µç‡¥±‡µç ‡¥®‡¥Æ‡µç‡¥™‡¥±‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø ‡¥∂‡µç‡¥∞‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥´‡¥≤‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï!",
                prizeAmount: "‡¥∏‡¥Æ‡µç‡¥Æ‡¥æ‡¥® ‡¥§‡µÅ‡¥ï:",
                number: "‡¥®‡¥Æ‡µç‡¥™‡µº:",
                date: "‡¥§‡µÄ‡¥Ø‡¥§‡¥ø:",
                viewFullResult: "‡¥™‡µÇ‡µº‡¥£‡µç‡¥£ ‡¥´‡¥≤‡¥Ç ‡¥ï‡¥æ‡¥£‡µÅ‡¥ï",
                backToHome: "‡¥π‡µã‡¥Ç ‡¥™‡µá‡¥ú‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç",
                congratulations: "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ‡¥Ö‡¥≠‡¥ø‡¥®‡¥®‡µç‡¥¶‡¥®‡¥ô‡µç‡¥ô‡µæ!"
            },
            ta: {
                pageTitle: "‡Æ≤‡Ææ‡Æü‡Øç‡Æü‡Æ∞‡Æø ‡Æ∏‡Øç‡Æï‡Øá‡Æ©‡Æ∞‡Øç",
                inputTitle: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æü‡Æø‡Æï‡Øç‡Æï‡ØÜ‡Æü‡Øç‡Æü‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                numberLabel: "‡Æü‡Æø‡Æï‡Øç‡Æï‡ØÜ‡Æü‡Øç ‡Æé‡Æ£‡Øç",
                dateLabel: "‡Æï‡Øã‡Æ≤‡Øç ‡Æ§‡Øá‡Æ§‡Æø",
                scanButton: "‡Æ∏‡Øç‡Æï‡Øá‡Æ©‡Øç ‡Æü‡Æø‡Æï‡Øç‡Æï‡ØÜ‡Æü‡Øç",
                initialMessage: "‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡Ææ ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà‡Æö‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æü‡Æø‡Æï‡Øç‡Æï‡ØÜ‡Æü‡Øç ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç",
                pleaseFill: "‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ™‡ØÅ‡Æ≤‡Æô‡Øç‡Æï‡Æ≥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æø‡Æ∞‡Æ™‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç",
                winner: (count) => `üéâ ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡ØÜ‡Æ©‡Øç‡Æ±‡ØÅ‡Æ≥‡Øç‡Æ≥‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç! ${count} ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ≥‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ`,
                noWin: "üòî ‡Æµ‡ØÜ‡Æ©‡Øç‡Æ± ‡Æé‡Æ£‡Øç‡Æï‡Æ≥‡Øç ‡Æé‡Æ§‡ØÅ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà",
                betterLuck: "‡ÆÖ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡ÆÆ‡ØÅ‡Æ±‡Øà ‡ÆÖ‡Æ§‡Æø‡Æï ‡ÆÖ‡Æ§‡Æø‡Æ∞‡Øç‡Æ∑‡Øç‡Æü‡ÆÆ‡Øç!",
                sorry: (number, date) => `‡ÆÆ‡Æ©‡Øç‡Æ©‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, "${number}" ‡Æé‡Æ©‡Øç‡Æ± ‡Æé‡Æ£‡Øç ${date} ‡ÆÖ‡Æ©‡Øç‡Æ±‡ØÅ ‡Æµ‡ØÜ‡Æ©‡Øç‡Æ± ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æï‡Ææ‡Æ£‡Æ™‡Øç‡Æ™‡Æü‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.`,
                keepTrying: "‡Æ™‡Æø‡Æ± ‡Æé‡Æ£‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç!",
                prizeAmount: "‡Æ™‡Æ∞‡Æø‡Æö‡ØÅ ‡Æ§‡Øä‡Æï‡Øà:",
                number: "‡Æé‡Æ£‡Øç:",
                date: "‡Æ§‡Øá‡Æ§‡Æø:",
                viewFullResult: "‡ÆÆ‡ØÅ‡Æ¥‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡Øà‡Æï‡Øç ‡Æï‡Ææ‡Æ£‡Øç‡Æï",
                backToHome: "‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤‡Æµ‡ØÅ‡ÆÆ‡Øç",
                congratulations: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Ææ‡Æ¥‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Æ≥‡Øç!"
            }
        };

        // Global variables
        let currentLang = 'en';
        let historyData = [];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('drawDate').value = formattedDate;
            
            // Load history data
            loadHistoryData();
            
            // Set initial language
            updateUILanguage();
        });

        // Switch language
        function switchLanguage(lang) {
            currentLang = lang;
            updateUILanguage();
            
            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Update UI language
        function updateUILanguage() {
            const t = langStrings[currentLang];
            
            document.getElementById('pageTitle').textContent = t.pageTitle;
            document.getElementById('inputTitle').textContent = t.inputTitle;
            document.getElementById('numberLabel').textContent = t.numberLabel;
            document.getElementById('dateLabel').textContent = t.dateLabel;
            document.getElementById('scanButton').textContent = t.scanButton;
            document.getElementById('initialMessage').textContent = t.initialMessage;
            document.getElementById('backButton').innerHTML = (currentLang === 'en' ? '‚Üê ' : '') + t.backToHome;
        }

        // Load history data
        async function loadHistoryData() {
            try {
                const response = await fetch('history.json');
                historyData = await response.json();
            } catch (error) {
                console.error('Error loading history data:', error);
            }
        }

        // Process manual input
        function processManualInput() {
            const t = langStrings[currentLang];
            const number = document.getElementById('ticketNumber').value.trim();
            const date = document.getElementById('drawDate').value;
            
            if (!number || !date) {
                alert(t.pleaseFill);
                return;
            }
            
            // Search in history.json
            const formattedDate = date.includes('-') ? date : date;
            const result = historyData.find(r => r.date === formattedDate || r.date === date);
            
            let found = null;
            let prizeInfo = null;
            let fileParam = '';
            
            if (result) {
                // Always set fileParam if result found
                if (result.lottery && result.draw && result.date) {
                    let dd, mm, yyyy;
                    if (result.date.includes('/')) {
                        [dd, mm, yyyy] = result.date.split('/');
                    } else if (result.date.includes('-')) {
                        [yyyy, mm, dd] = result.date.split('-');
                    }
                    let drawStr = String(result.draw).padStart(2, '0');
                    if (drawStr.startsWith(result.lottery + '-')) {
                        drawStr = drawStr.replace(result.lottery + '-', '');
                    }
                    if (result.lottery && drawStr && yyyy && mm && dd) {
                        fileParam = `${result.lottery}-${drawStr}-${yyyy}-${mm}-${dd}.json`;
                    } else {
                        fileParam = '';
                    }
                }
                
                // Normalize the search number for comparison
                const searchLower = number.replace(/\s+/g, '').toLowerCase();
                
                // Check all prizes using enhanced matching logic
                if (result.prizes && Array.isArray(result.prizes)) {
                    for (const prize of result.prizes) {
                        if (Array.isArray(prize.winners)) {
                            for (const winner of prize.winners) {
                                // Normalize the winner number for comparison
                                const numClean = winner.replace(/\s+/g, '').toLowerCase();
                                
                                // Enhanced matching logic to prevent overly broad matches
                                let isMatch = false;
                                
                                // Exact match - most precise
                                if (numClean === searchLower) {
                                    isMatch = true;
                                }
                                // Series number matching (e.g., "PM 162584" matching "PM 162584 (KOTTAYAM)")
                                else if (searchLower.length > 4 && numClean.startsWith(searchLower) && 
                                         numClean.length > searchLower.length) {
                                    // Check if the remaining part is location info in parentheses
                                    const remainder = numClean.substring(searchLower.length).trim();
                                    if (remainder.startsWith('(') && remainder.endsWith(')')) {
                                        isMatch = true;
                                    }
                                }
                                // For partial matches, be more restrictive:
                                // Only match if the search term is at the end of the number (common in lottery patterns)
                                else if (searchLower.length >= 4 && numClean.length > searchLower.length) {
                                    // Check if search term matches the end of the number (common in lottery patterns)
                                    if (numClean.endsWith(searchLower)) {
                                        isMatch = true;
                                    }
                                    // Special case for full ticket numbers like "PM 162584"
                                    else if (searchLower.includes(numClean) && Math.abs(searchLower.length - numClean.length) <= 3) {
                                        // Only match if the lengths are close (to avoid matching short numbers in long ones)
                                        isMatch = true;
                                    }
                                }
                                // Special case for lottery numbers - match last 6 digits exactly
                                else if (searchLower.length === 6 && numClean.length >= 6) {
                                    const numLast6 = numClean.slice(-6);
                                    if (searchLower === numLast6) {
                                        isMatch = true;
                                    }
                                }
                                
                                if (isMatch) {
                                    found = { number: number, date: result.date, status: 'winner', code: result.lottery, draw: result.draw, fileParam };
                                    prizeInfo = { label: prize.label, amount: prize.amount };
                                    break;
                                }
                            }
                        }
                        if (found) break;
                    }
                }
            }
            
            if (found) {
                found.prizeInfo = prizeInfo;
                displayScanResult(found);
            } else {
                displayScanResult({ number, date, status: 'no-win', prize: 'No Win', fileParam });
            }
        }

        // Display scan result
        function displayScanResult(result) {
            const t = langStrings[currentLang];
            const resultsContainer = document.getElementById('scannerResults');
            
            if (result.status === 'winner') {
                const resultHtml = `
                <div class="winner-card text-white p-6 text-center font-bold mb-6">
                    <div class="text-2xl mb-2">${t.winner(1)}</div>
                    <div class="text-lg">${t.congratulations}</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 w-full flex flex-col items-center border-2 border-green-200 result-card">
                    <div class="text-xl font-bold text-green-700 mb-3">${result.prizeInfo.label}</div>
                    <div class="mb-2"><span class="font-semibold text-gray-700">${t.number || 'Number:'}</span> <span class="text-gray-900 font-mono bg-gray-100 px-2 py-1 rounded">${result.number}</span></div>
                    <div class="mb-2"><span class="font-semibold text-gray-700">${t.prizeAmount || 'Prize Amount:'}</span> <span class="text-gray-900">${result.prizeInfo.amount}</span></div>
                    <div class="mb-4"><span class="font-semibold text-gray-700">${t.date || 'Date:'}</span> <span class="text-gray-900">${result.date}</span></div>
                    ${result.fileParam ? `<a href="result.html?file=${result.fileParam}" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-2 px-6 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">${t.viewFullResult || 'View Full Result Page'}</a>` : ''}
                </div>
                `;
                resultsContainer.innerHTML = resultHtml;
            } else {
                const resultHtml = `
                <div class="bg-gradient-to-r from-red-100 to-pink-100 rounded-xl p-8 text-center">
                    <div class="text-2xl font-bold text-red-700 mb-4">${t.noWin}</div>
                    <div class="text-lg text-red-600 mb-4">${t.betterLuck}</div>
                    <div class="text-gray-700 mb-4">${t.sorry(result.number, result.date)}</div>
                    <div class="text-gray-600">${t.keepTrying}</div>
                </div>
                `;
                resultsContainer.innerHTML = resultHtml;
            }
        }
    </script>
</body>
</html>
